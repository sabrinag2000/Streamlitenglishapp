import os
import streamlit as st
import openai

def init_openai():
    openai.api_key = os.getenv("OPENAI_API_KEY")

st.set_page_config(page_title="Aprenda InglÃªs com Ãudio", layout="centered")
init_openai()

st.title("Aprenda InglÃªs com Ãudio")

# 1. Tradutor PT â†’ EN + TTS
st.header("1. Traduzir e Ouvir")
pt_text = st.text_area("Digite algo em portuguÃªs:", height=100)
if st.button("ğŸ”Š Traduzir e Falar"):
    if not pt_text.strip():
        st.warning("Por favor, insira um texto em portuguÃªs.")
    else:
        # Chat completion for translation
        response = openai.ChatCompletion.create(
            model="gpt-4o",
            messages=[
                {"role": "user", "content": f"Traduza para inglÃªs: \"{pt_text}\""}
            ]
        )
        en_text = response.choices[0].message.content.strip()
        st.markdown(f"**InglÃªs:** {en_text}")

        # TTS generation
        tts_resp = openai.Audio.speech.create(
            model="tts-1",
            input=en_text,
            voice="nova"
        )
        st.audio(tts_resp, format="audio/mpeg")

# 2. Upload de Ã¡udio para gravaÃ§Ã£o e correÃ§Ã£o
st.header("2. Corrigir seu InglÃªs via Ãudio")
audio_file = st.file_uploader("Envie um arquivo de Ã¡udio (mp3/wav) com sua fala:", type=["mp3", "wav"])
if audio_file is not None:
    # TranscriÃ§Ã£o via Whisper
    with st.spinner("Transcrevendo Ã¡udio..."):
        transcript = openai.Audio.transcribe("whisper-1", audio_file)
    recognized = transcript["text"].strip()
    st.markdown(f"**VocÃª disse:** {recognized}")

    if st.button("ğŸ“˜ Corrigir e Ouvir"):
        # CorreÃ§Ã£o via ChatCompletion
        system_prompt = (
            "VocÃª Ã© um professor de inglÃªs. "
            "Corrija gramÃ¡tica, pronÃºncia e vocabulÃ¡rio do texto abaixo e responda apenas com a frase corrigida em inglÃªs:"
        )
        chat = openai.ChatCompletion.create(
            model="gpt-4o",
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": recognized}
            ]
        )
        corrected = chat.choices[0].message.content.strip()
        st.markdown(f"**CorreÃ§Ã£o:** {corrected}")

        # TTS da correÃ§Ã£o
        tts2 = openai.Audio.speech.create(
            model="tts-1",
            input=corrected,
            voice="nova"
        )
        st.audio(tts2, format="audio/mpeg")


Criei um app Streamlit (app.py) que:

1. Traduz texto de portuguÃªs para inglÃªs e reproduz via TTS.


2. Permite fazer upload de um Ã¡udio (MP3/WAV), transcreve com Whisper, corrige gramÃ¡tica/pronÃºncia e reproduz a correÃ§Ã£o via TTS.



Para executar:

1. Instale dependÃªncias:

pip install streamlit openai


2. Defina sua chave de API:

export OPENAI_API_KEY="sua_chave_aqui"


3. Rode:

streamlit run app.py



Abra no navegador e aproveite!

